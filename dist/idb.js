(()=>{var t={757:(t,e,n)=>{t.exports=n(666)},666:t=>{var e=function(t){"use strict";var e,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),o=new T(r||[]);return a._invoke=function(t,e,n){var r=f;return function(i,a){if(r===d)throw new Error("Generator is already running");if(r===y){if("throw"===i)throw a;return L()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var u=E(o,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===f)throw r=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=d;var c=l(t,e,n);if("normal"===c.type){if(r=n.done?y:h,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=y,n.method="throw",n.arg=c.arg)}}}(t,n,o),a}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var f="suspendedStart",h="suspendedYield",d="executing",y="completed",v={};function p(){}function b(){}function m(){}var g={};c(g,a,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(B([])));x&&x!==n&&r.call(x,a)&&(g=x);var k=m.prototype=p.prototype=Object.create(g);function R(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function n(i,a,o,u){var c=l(t[i],t,a);if("throw"!==c.type){var s=c.arg,f=s.value;return f&&"object"==typeof f&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,o,u)}),(function(t){n("throw",t,o,u)})):e.resolve(f).then((function(t){s.value=t,o(s)}),(function(t){return n("throw",t,o,u)}))}u(c.arg)}var i;this._invoke=function(t,r){function a(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(a,a):a()}}function E(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=l(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function B(t){if(t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}return{next:L}}function L(){return{value:e,done:!0}}return b.prototype=m,c(k,"constructor",m),c(m,"constructor",b),b.displayName=c(m,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,c(t,u,"GeneratorFunction")),t.prototype=Object.create(k),t},t.awrap=function(t){return{__await:t}},R(O.prototype),c(O.prototype,o,(function(){return this})),t.AsyncIterator=O,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new O(s(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},R(k),c(k,u,"Generator"),c(k,a,(function(){return this})),c(k,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=B,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(S),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return u.type="throw",u.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],u=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),s=r.call(o,"finallyLoc");if(c&&s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),S(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;S(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:B(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var a=e[r]={exports:{}};return t[r](a,a.exports,n),a.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";function t(t,e,n,r,i,a,o){try{var u=t[a](o),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,i)}function e(e){return function(){var n=this,r=arguments;return new Promise((function(i,a){var o=e.apply(n,r);function u(e){t(o,i,a,u,c,"next",e)}function c(e){t(o,i,a,u,c,"throw",e)}u(void 0)}))}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var o,u,c,s,l=n(757),f=n.n(l),h="syncOn",d="_id";function y(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){u=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}!function(t){t.ReadOnly="readonly",t.Write="readwrite",t.VersionChange="versionchange"}(o||(o={})),function(t){t.HasOne="hasOne",t.HasMany="hasMany",t.HasManyMultiEntry="hasManyMultiEntry",t.HasManyThroughMultiEntry="hasManyThroughMultiEntry"}(u||(u={})),function(t){t.Between="between",t.Where="where",t.WhereIn="whereIn",t.WhereInArray="whereInArray",t.GreaterThan="gt",t.GreaterThanEqual="gte",t.LessThanEqual="lte",t.LessThan="lt"}(c||(c={})),function(t){t.Ascending="next",t.AscendingUnique="nextunique",t.Descending="prev",t.DescendingUnique="prevunique"}(s||(s={}));var p=function(){function t(e,n,i){r(this,t),this.tables=e,this.db=n,this.transaction=i}var n;return a(t,[{key:"run",value:(n=e(f().mark((function t(){var e,n,r,i,a,o,u=this;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=y(this.tables);try{for(e.s();!(n=e.n()).done;)r=n.value,this.db.objectStoreNames.contains(r.name)?r.objectStore=this.transaction.objectStore(r.name):r.objectStore=this.createObjectStore(r),this.createColumns(r,r.objectStore),this.dropOldColumns(r,r.objectStore),this.setupSyncColumn(r,r.objectStore)}catch(t){e.e(t)}finally{e.f()}i=y(this.allStoreNames());try{for(o=function(){var t=a.value;u.tables.find((function(e){return e.name===t}))||u.db.deleteObjectStore(t)},i.s();!(a=i.n()).done;)o()}catch(t){i.e(t)}finally{i.f()}return t.abrupt("return",this.tables);case 5:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"createIndex",value:function(t,e){var n=t.attributes||{},r=t.index||t.name;return e.createIndex(t.name,r,n)}},{key:"dropIndex",value:function(t,e){return e.deleteIndex(t),!0}},{key:"createObjectStore",value:function(t){var e=t.primary||d;return this.db.createObjectStore(t.name,{keyPath:e,autoIncrement:!0})}},{key:"dropObjectStore",value:function(t){return!0}},{key:"createColumns",value:function(t,e){var n,r=y(t.columns);try{for(r.s();!(n=r.n()).done;){var i=n.value;e.indexNames.contains(i.name)||(i.dbIndex=this.createIndex(i,e))}}catch(t){r.e(t)}finally{r.f()}}},{key:"dropOldColumns",value:function(t,e){for(var n=this,r=e.indexNames,i=function(i){t.columns.find((function(t){return t.name===r[i]}))||n.dropIndex(r[i],e)},a=0;a<r.length;a++)i(a)}},{key:"allStoreNames",value:function(){for(var t=[],e=0;e<this.db.objectStoreNames.length;e++)t.push(this.db.objectStoreNames[e]);return t}},{key:"listObjectStores",value:function(){var t,e=[],n=y(this.allStoreNames());try{for(n.s();!(t=n.n()).done;){var r=t.value;e.push(this.transaction.objectStore(r))}}catch(t){n.e(t)}finally{n.f()}return e}},{key:"setupSyncColumn",value:function(t,e){var n=t.syncColumnName||h;t.syncColumn?e.indexNames.contains(n)||this.createIndex({name:n,index:n},e):e.indexNames.contains(n)&&this.dropIndex(n,e)}}]),t}();function b(t,e){return b=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},b(t,e)}function m(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&b(t,e)}function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function w(t,e){if(e&&("object"===g(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function x(t){return x=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},x(t)}function k(t,e){for(var n=t.split("."),r=e,i=0;i<n.length;i++){if(void 0===r[n[i]])return;r=r[n[i]]}return r}function R(t,e){for(var n in t)e.hasOwnProperty(n)&&(e[n]instanceof Object?t[n]=R({},e[n]):t[n]=e[n]);for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r]);return t}function O(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return E(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){u=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}function E(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var I=function(t){m(o,t);var e,n,i=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=x(e);if(n){var i=x(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return w(this,t)});function o(){var t;return r(this,o),(t=i.apply(this,arguments)).indexBuilder=null,t.builder=[],t.cursor=null,t}return a(o,[{key:"whereIndex",value:function(t,e){return this.indexBuilder={index:t,value:e,type:c.Where},this}},{key:"whereIndexIn",value:function(t,e){return this.indexBuilder={index:t,value:e,type:c.WhereIn},this}},{key:"whereMultiIndexIn",value:function(t,e){return this.indexBuilder={index:t,value:e,type:c.WhereInArray},this}},{key:"indexGte",value:function(t,e){return this.indexBuilder={index:t,value:e,type:c.GreaterThanEqual},this}},{key:"indexGt",value:function(t,e){return this.indexBuilder={index:t,value:e,type:c.GreaterThan},this}},{key:"indexLte",value:function(t,e){return this.indexBuilder={index:t,value:e,type:c.LessThanEqual},this}},{key:"indexLt",value:function(t,e){return this.indexBuilder={index:t,value:e,type:c.LessThan},this}},{key:"indexBetween",value:function(t,e,n){return this.indexBuilder={index:t,value:[e,n],type:c.Between},this}},{key:"where",value:function(t,e){return this.builder.push({attribute:t,value:e,type:c.Where}),this}},{key:"whereIn",value:function(t,e){return this.builder.push({attribute:t,value:e,type:c.WhereIn}),this}},{key:"whereInArray",value:function(t,e){return this.builder.push({attribute:t,value:e,type:c.WhereInArray}),this}},{key:"gte",value:function(t,e){return this.builder.push({attribute:t,value:e,type:c.GreaterThanEqual}),this}},{key:"gt",value:function(t,e){return this.builder.push({attribute:t,value:e,type:c.GreaterThan}),this}},{key:"lte",value:function(t,e){return this.builder.push({attribute:t,value:e,type:c.LessThanEqual}),this}},{key:"lt",value:function(t,e){return this.builder.push({attribute:t,value:e,type:c.LessThan}),this}},{key:"between",value:function(t,e,n){return this.builder.push({attribute:t,value:[e,n],type:c.Between}),this}},{key:"cursorDirection",value:function(t){return this.cursor=t,this}},{key:"keyRange",value:function(t){var e;switch(t.type){case c.Where:e=IDBKeyRange.only(t.value);break;case c.WhereIn:this.whereIn(t.index,t.value);var n=t.value.sort();e=IDBKeyRange.bound(n[0],n[n.length-1],!1,!1);break;case c.GreaterThanEqual:e=IDBKeyRange.lowerBound(t.value,!1);break;case c.GreaterThan:e=IDBKeyRange.lowerBound(t.value,!0);break;case c.LessThanEqual:e=IDBKeyRange.upperBound(t.value,!1);break;case c.LessThan:e=IDBKeyRange.lowerBound(t.value,!0);break;case c.Between:e=IDBKeyRange.bound(t.value[0],t.value[1],!1,!1);break;case c.WhereInArray:this.whereInArray(t.index,t.value);var r=t.value.sort();e=IDBKeyRange.bound(r[0],r[r.length-1],!1,!1);break;default:throw"Invalid builder type given"}return e}},{key:"allowedToProcess",value:function(t){var e,n=O(this.builder);try{for(n.s();!(e=n.n()).done;){var r=e.value;switch(r.type){case c.Where:if(!k(r.attribute,t)===r.value)return!1;break;case c.WhereIn:var i,a=!1,o=k(r.attribute,t),u=O(r.value);try{for(u.s();!(i=u.n()).done;)if(o===i.value){a=!0;break}}catch(t){u.e(t)}finally{u.f()}if(!a)return!1;break;case c.WhereInArray:var s=!1,l=k(r.attribute,t);if(!(l instanceof Array))return!1;var f,h=O(r.value);try{for(h.s();!(f=h.n()).done;){var d=f.value;if(l.includes(d)){s=!0;break}}}catch(t){h.e(t)}finally{h.f()}if(!s)return!1;break;case c.GreaterThan:if(k(r.attribute,t)<=r.value)return!1;break;case c.GreaterThanEqual:if(k(r.attribute,t)<r.value)return!1;break;case c.LessThan:if(k(r.attribute,t)>=r.value)return!1;break;case c.LessThanEqual:if(k(r.attribute,t)>r.value)return!1;break;case c.Between:var y=k(r.attribute,t);if(r.value[0]>=y&&r.value[1]<=y)return!1;break;default:throw new Error("Query type not recognized")}}}catch(t){n.e(t)}finally{n.f()}return!0}},{key:"resetBuilder",value:function(){return this.indexBuilder=null,this.builder=[],this}}]),o}(function(){function t(){r(this,t),this.relations=[],this.customRelations=[]}return a(t,[{key:"tableNames",value:function(t){return t.map((function(t){return t.name}))}},{key:"with",value:function(t){var e=this.relations.filter((function(e){return!t.find((function(t){return t.model===e.model}))}));return this.relations=e.concat(t),this}},{key:"relation",value:function(t,e,n,r,i){var a=this.relations.findIndex((function(e){return e.model===t}));return-1!==a&&this.relations.splice(a,1),this.relations.push({model:t,type:e,localKey:n,foreignKey:r,func:i}),this}},{key:"withCustom",value:function(t){var e=this.customRelations.filter((function(e){return!t.find((function(t){return t===e}))}));return this.customRelations=e.concat(t),this}}]),t}());var S=function(t){m(o,t);var e,n,i=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=x(e);if(n){var i=x(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return w(this,t)});function o(){return r(this,o),i.apply(this,arguments)}return a(o,[{key:"filteredModel",value:function(t,e){t=this.bindBuilder(t);var n=new I;if(e.func){var r=e.func(n);t.builder=t.builder.concat(r.builder),t.with(n.relations)}return t}},{key:"bindBuilder",value:function(t){return t.builder=t.builder.concat(this.builder),t.with(this.relations),t}},{key:"getRelationModel",value:function(t){var e;if("string"==typeof t.model){var n=this.connector.migrationSchema.tables.find((function(e){return e.name===t.model}));if(!n)throw new Error("Table schema not found");e=new H(this.db,n,this.connector)}else e=t.model;return e}},{key:"getLocalKey",value:function(t,e){var n=t.table.primary||d;return e.localKey?e.localKey:n}},{key:"getAttributeName",value:function(t,e){return e.attributeName||t.table.name}}]),o}(I);var T=function(t){m(c,t);var n,i,o,u=(i=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=x(i);if(o){var n=x(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return w(this,t)});function c(t,e,n,i){var a;return r(this,c),(a=u.call(this)).db=t,a.connector=e,a.parentModel=n,a.childRelation=i,a}return a(c,[{key:"fetch",value:(n=e(f().mark((function t(e){var n,r,i,a=this;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.getRelationModel(this.childRelation),n=this.filteredModel(n,this.childRelation),r=[],1!==e.length){t.next=11;break}return n.whereIndex(this.childRelation.foreignKey,e[0][this.getLocalKey(this.parentModel,this.childRelation)]),t.next=7,n.first();case 7:t.t0=t.sent,r=[t.t0],t.next=16;break;case 11:return i=e.map((function(t){return t[a.getLocalKey(a.parentModel,a.childRelation)]})),n.whereIndexIn(this.childRelation.foreignKey,i).cursorDirection(s.AscendingUnique),t.next=15,n.all();case 15:r=t.sent;case 16:return t.abrupt("return",this.bindResults(e,r,this.childRelation));case 17:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"bindResults",value:function(t,e,n){var r=this,i=this.getLocalKey(this.parentModel,this.childRelation);return t.forEach((function(t){var a=e.find((function(e){return e[n.foreignKey]===t[i]}));t[r.getAttributeName(r.parentModel,n)]=a||null})),Promise.resolve(t)}}]),c}(S);var B=function(t){m(c,t);var n,i,o,u=(i=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=x(i);if(o){var n=x(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return w(this,t)});function c(t,e,n,i){var a;return r(this,c),(a=u.call(this)).db=t,a.connector=e,a.parentModel=n,a.childRelation=i,a}return a(c,[{key:"fetch",value:(n=e(f().mark((function t(e){var n,r,i,a=this;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.getRelationModel(this.childRelation),n=this.filteredModel(n,this.childRelation),r=e.map((function(t){return t[a.getLocalKey(a.parentModel,a.childRelation)]})),n.whereIndexIn(this.childRelation.foreignKey,r),t.next=6,n.all();case 6:return i=t.sent,t.abrupt("return",this.bindResults(e,i,this.childRelation));case 8:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"bindResults",value:function(t,e,n){var r=this,i=this.getLocalKey(this.parentModel,this.childRelation);return t.forEach((function(t){t[r.getAttributeName(r.parentModel,n)]=e.filter((function(e){return e[n.foreignKey]===t[i]}))})),Promise.resolve(t)}}]),c}(S);var L=function(t){m(c,t);var n,i,o,u=(i=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=x(i);if(o){var n=x(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return w(this,t)});function c(t,e,n,i){var a;return r(this,c),(a=u.call(this)).db=t,a.connector=e,a.parentModel=n,a.childRelation=i,a}return a(c,[{key:"fetch",value:(n=e(f().mark((function t(e){var n,r,i,a=this;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.getRelationModel(this.childRelation),n=this.filteredModel(n,this.childRelation),r=e.map((function(t){return t[a.getLocalKey(a.parentModel,a.childRelation)]})),n.whereMultiIndexIn(this.childRelation.foreignKey,r),t.next=6,n.all();case 6:return i=t.sent,t.abrupt("return",this.bindResults(e,i,this.childRelation));case 8:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"bindResults",value:function(t,e,n){var r=this,i=this.getLocalKey(this.parentModel,this.childRelation);return t.forEach((function(t){t[r.getAttributeName(r.parentModel,n)]=e.filter((function(e){return!!e[n.foreignKey].find((function(e){return e===t[i]}))}))})),Promise.resolve(t)}}]),c}(S);var j=function(t){m(c,t);var n,i,o,u=(i=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=x(i);if(o){var n=x(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return w(this,t)});function c(t,e,n,i){var a;return r(this,c),(a=u.call(this)).db=t,a.connector=e,a.parentModel=n,a.childRelation=i,a}return a(c,[{key:"fetch",value:(n=e(f().mark((function t(e){var n,r,i,a=this;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.getRelationModel(this.childRelation),n=this.filteredModel(n,this.childRelation),r=e.reduce((function(t,e){return t.concat(e[a.getLocalKey(a.parentModel,a.childRelation)])}),[]),n.whereIndexIn(this.childRelation.foreignKey,r),t.next=6,n.all();case 6:return i=t.sent,t.abrupt("return",this.bindResults(e,i,this.childRelation));case 8:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"bindResults",value:function(t,e,n){var r=this,i=this.getLocalKey(this.parentModel,this.childRelation);return t.forEach((function(t){t[r.getAttributeName(r.parentModel,n)]=e.filter((function(e){return!!t[i].find((function(t){return t===e[n.foreignKey]}))}))})),Promise.resolve(t)}}]),c}(S);var M=function(t){m(c,t);var n,i,u=(n=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=x(n);if(i){var r=x(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return w(this,t)});function c(){return r(this,c),u.apply(this,arguments)}return a(c,[{key:"all",value:function(){var t=this,n=this.tableNames(this.connector.migrationSchema.tables).concat(this.table.name),r=this.getTransaction(n,o.ReadOnly).objectStore(this.table.name),i=this.request(r);return new Promise((function(n,r){var a=[];i.addEventListener("success",function(){var r=e(f().mark((function e(r){var i,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=r.target.result)){e.next=6;break}if(t.allowedToProcess(i.value)){e.next=4;break}return e.abrupt("return",i.continue());case 4:return a.push(i.value),e.abrupt("return",i.continue());case 6:return 0!==a.length&&0!==t.relations.length||n(a),o=t.loadRelations(a),e.next=10,Promise.all(o);case 10:n(a);case 11:case"end":return e.stop()}}),e)})));return function(t){return r.apply(this,arguments)}}()),i.addEventListener("error",(function(t){return r(t)}))}))}},{key:"first",value:function(){var t=this,n=this.tableNames(this.connector.migrationSchema.tables).concat(this.table.name),r=this.getTransaction(n,o.ReadOnly).objectStore(this.table.name),i=this.request(r);return new Promise((function(n,r){var a;i.addEventListener("success",function(){var r=e(f().mark((function e(r){var i,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=r.target.result)){e.next=5;break}if(t.allowedToProcess(i.value)){e.next=4;break}return e.abrupt("return",i.continue());case 4:a=i.value;case 5:return a&&0!==t.relations.length||n(a||null),o=t.loadRelations([a]),e.next=9,Promise.all(o);case 9:n(a);case 10:case"end":return e.stop()}}),e)})));return function(t){return r.apply(this,arguments)}}()),i.addEventListener("error",(function(t){return r(t)}))}))}},{key:"find",value:function(t){var n=this,r=this.tableNames(this.connector.migrationSchema.tables).concat(this.table.name),i=this.getTransaction(r,o.ReadOnly).objectStore(this.table.name).get(t);return new Promise((function(t,r){i.addEventListener("success",function(){var r=e(f().mark((function e(r){var i,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=r.target.result)&&0!==n.relations.length||t(i||null),a=n.loadRelations([i]),e.next=5,Promise.all(a);case 5:t(i||null);case 6:case"end":return e.stop()}}),e)})));return function(t){return r.apply(this,arguments)}}()),i.addEventListener("error",(function(t){return r(t)}))}))}},{key:"findIndex",value:function(t,n){var r=this;this.resetBuilder();var i=this.tableNames(this.connector.migrationSchema.tables).concat(this.table.name),a=this.getTransaction(i,o.ReadOnly).objectStore(this.table.name).index(t).get(n);return new Promise((function(t,n){a.addEventListener("success",function(){var n=e(f().mark((function e(n){var i,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=n.target.result)&&0!==r.relations.length||t(i||null),a=r.loadRelations([i]),e.next=5,Promise.all(a);case 5:t(i);case 6:case"end":return e.stop()}}),e)})));return function(t){return n.apply(this,arguments)}}()),a.addEventListener("error",(function(t){return n(t)}))}))}},{key:"findAllIndex",value:function(t,e){return this.resetBuilder(),this.whereIndex(t,e),this.all()}}]),c}(function(t){m(c,t);var n,i,u=(n=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=x(n);if(i){var r=x(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return w(this,t)});function c(t,e){var n;return r(this,c),(n=u.call(this)).db=t,n.table=e,n}return a(c,[{key:"count",value:function(){var t,n=this,r=[this.table.name],i=this.getTransaction(r,o.ReadOnly).objectStore(this.table.name);return t=0===this.builder.length&&null===this.indexBuilder?i.count():0===this.builder.length&&null!==this.indexBuilder?i.count(this.keyRange(this.indexBuilder)):this.request(i),new Promise((function(r,i){var a=0;t.addEventListener("success",function(){var t=e(f().mark((function t(e){var i;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==n.builder.length){t.next=2;break}return t.abrupt("return",r(e.target.result));case 2:if(!(i=e.target.result)){t.next=8;break}if(n.allowedToProcess(i.value)){t.next=6;break}return t.abrupt("return",i.continue());case 6:return a++,t.abrupt("return",i.continue());case 8:r(a);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.addEventListener("error",(function(t){return i(t)}))}))}},{key:"average",value:function(t){var n=this,r=[this.table.name],i=this.getTransaction(r,o.ReadOnly).objectStore(this.table.name),a=this.request(i);return new Promise((function(r,i){var o=0,u=0;a.addEventListener("success",function(){var i=e(f().mark((function e(i){var a,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=i.target.result)){e.next=8;break}if(n.allowedToProcess(a.value)){e.next=4;break}return e.abrupt("return",a.continue());case 4:return c=k(t,a.value),isNaN(parseFloat(c))||(u+=parseFloat(a.value[t])),o++,e.abrupt("return",a.continue());case 8:r(u/o);case 9:case"end":return e.stop()}}),e)})));return function(t){return i.apply(this,arguments)}}()),a.addEventListener("error",(function(t){return i(t)}))}))}},{key:"reduce",value:function(t,n){var r=this,i=[this.table.name],a=this.getTransaction(i,o.ReadOnly).objectStore(this.table.name),u=this.request(a);return new Promise((function(i,a){var o=n;u.addEventListener("success",function(){var n=e(f().mark((function e(n){var a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=n.target.result)){e.next=6;break}if(r.allowedToProcess(a.value)){e.next=4;break}return e.abrupt("return",a.continue());case 4:return o=t(a.value,o),e.abrupt("return",a.continue());case 6:i(o);case 7:case"end":return e.stop()}}),e)})));return function(t){return n.apply(this,arguments)}}()),u.addEventListener("error",(function(t){return a(t)}))}))}}]),c}(function(t){m(o,t);var e,n,i=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=x(e);if(n){var i=x(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return w(this,t)});function o(){return r(this,o),i.apply(this,arguments)}return a(o,[{key:"request",value:function(t){var e=this.cursor||void 0;if(this.indexBuilder){var n=this.keyRange(this.indexBuilder);return(this.indexBuilder.index!==this.primaryId?t.index(this.indexBuilder.index):t).openCursor(n,e)}return t.openCursor(void 0,e)}}]),o}(function(t){m(o,t);var e,n,i=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=x(e);if(n){var i=x(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return w(this,t)});function o(){var t;return r(this,o),(t=i.apply(this,arguments)).transaction=null,t}return a(o,[{key:"getTransaction",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(null===this.transaction||n)&&(this.transaction=this.createTransaction(t,e)),this.transaction}},{key:"setTransaction",value:function(t){this.transaction=t}},{key:"createTransaction",value:function(t,e){var n=this.db.transaction(t,e);return this.setTransaction(n),n}}]),o}(function(t){m(o,t);var e,n,i=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=x(e);if(n){var i=x(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return w(this,t)});function o(){return r(this,o),i.apply(this,arguments)}return a(o,[{key:"hasOne",value:function(t,e,n,r){var i=this.convertToRelation(t,u.HasOne,e);return n&&(i.localKey=n),r&&(i.attributeName=r),new T(this.db,this.connector,this,i)}},{key:"hasMany",value:function(t,e,n,r){var i=this.convertToRelation(t,u.HasMany,e);return n&&(i.localKey=n),r&&(i.attributeName=r),new B(this.db,this.connector,this,i)}},{key:"hasManyMultiEntry",value:function(t,e,n,r){var i=this.convertToRelation(t,u.HasManyMultiEntry,e);return n&&(i.localKey=n),r&&(i.attributeName=r),new L(this.db,this.connector,this,i)}},{key:"hasManyThroughMultiEntry",value:function(t,e,n,r){var i=this.convertToRelation(t,u.HasManyThroughMultiEntry,e);return n&&(i.localKey=n),r&&(i.attributeName=r),new j(this.db,this.connector,this,i)}},{key:"convertToRelation",value:function(t,e,n){return{model:this.newModel(t),type:e,foreignKey:n}}},{key:"newModel",value:function(t){var e=this.connector.migrationSchema.tables.find((function(e){return e.name===t.TableName}));if(!e)throw new Error("Table schema not found");return new t(this.db,e,this.connector)}}]),o}(I)))));function P(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function A(t,e,n){return A=P()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&b(i,n.prototype),i},A.apply(null,arguments)}function N(t){var e="function"==typeof Map?new Map:void 0;return N=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return A(t,arguments,x(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),b(r,t)},N(t)}var C=function(t){m(o,t);var e,n,i=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=x(e);if(n){var i=x(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return w(this,t)});function o(){return r(this,o),i.call(this,"Record not found")}return a(o)}(N(Error));var K=function(t){m(l,t);var n,i,o,u,c,s=(u=l,c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=x(u);if(c){var n=x(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return w(this,t)});function l(){return r(this,l),s.apply(this,arguments)}return a(l,[{key:"firstOrFail",value:(o=e(f().mark((function t(){var e;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.first();case 2:if(e=t.sent){t.next=5;break}throw new C;case 5:return t.abrupt("return",e);case 6:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"findOrFail",value:(i=e(f().mark((function t(e){var n;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.find(e);case 2:if(n=t.sent){t.next=5;break}throw new C;case 5:return t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"findIndexOrFail",value:(n=e(f().mark((function t(e,n){var r;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.findIndex(e,n);case 2:if(r=t.sent){t.next=5;break}throw new C;case 5:return t.abrupt("return",r);case 6:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})}]),l}(M);var W=function(t){m(o,t);var e,n,i=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=x(e);if(n){var i=x(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return w(this,t)});function o(){return r(this,o),i.apply(this,arguments)}return a(o)}(N(Error));function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function q(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return _(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){u=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var H=function(t){m(y,t);var n,i,o,c,s,l=(c=y,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=x(c);if(s){var n=x(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return w(this,t)});function y(t,e,n){var i;return r(this,y),(i=l.call(this,t,e)).db=t,i.table=e,i.connector=n,i.transaction=null,i}return a(y,[{key:"sync",value:(o=e(f().mark((function t(e,n){var r,i=arguments;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=!(i.length>2&&void 0!==i[2])||i[2],t.next=3,this.save(e,this.syncObj(n),r);case 3:return t.abrupt("return",this.find(e));case 4:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)})},{key:"syncIndex",value:(i=e(f().mark((function t(e,n,r){var i,a=arguments;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=!(a.length>3&&void 0!==a[3])||a[3],t.next=3,this.saveIndex(e,n,this.syncObj(r),i);case 3:return t.abrupt("return",this.findIndex(e,n));case 4:case"end":return t.stop()}}),t,this)}))),function(t,e,n){return i.apply(this,arguments)})},{key:"syncAllIndex",value:(n=e(f().mark((function t(e,n,r){var i,a=arguments;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=!(a.length>3&&void 0!==a[3])||a[3],t.next=3,this.saveAllIndex(e,n,this.syncObj(r),i);case 3:return t.abrupt("return",this.resetBuilder().whereIndex(e,n).all());case 4:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return n.apply(this,arguments)})},{key:"openTransaction",value:function(t){var e,n=this,r=this.db.transaction(this.connector.migrationSchema.tables.map((function(t){return t.name}))),i={},a=q(this.connector.migrationSchema.tables);try{var o=function(){var t=e.value;Object.defineProperty(i,t.name,{get:function(){var e;return(e=n.table.ormClass?new n.table.ormClass(n.db,t,n.connector):new y(n.db,t,n.connector)).setTransaction(r),e}})};for(a.s();!(e=a.n()).done;)o()}catch(t){a.e(t)}finally{a.f()}return{models:i,transaction:r}}},{key:"loadRelations",value:function(t){var e,n=[],r=q(this.relations);try{for(r.s();!(e=r.n()).done;){var i=e.value,a=void 0;switch(i.type){case u.HasOne:a=new T(this.db,this.connector,this,i),n.push(a.fetch(t));break;case u.HasMany:a=new B(this.db,this.connector,this,i),n.push(a.fetch(t));break;case u.HasManyMultiEntry:a=new L(this.db,this.connector,this,i),n.push(a.fetch(t));break;case u.HasManyThroughMultiEntry:a=new j(this.db,this.connector,this,i),n.push(a.fetch(t));break;default:throw new Error("Unknown relation ".concat(i.type))}}}catch(t){r.e(t)}finally{r.f()}return n.concat(this.loadCustomRelations(t))}},{key:"primaryId",get:function(){return this.table.primary||d}},{key:"loadCustomRelations",value:function(t){var e,n=[],r=q(this.customRelations);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(!Reflect.has(this,i))throw new Error("Method ".concat(i," not defined."));var a=Reflect.get(this,i)();n.push(a.fetch(t))}}catch(t){r.e(t)}finally{r.f()}return n}},{key:"syncObj",value:function(t){if(this.table.syncColumn){var e={};return e[this.table.syncColumnName||h]=new Date,R(t,e)}return t}}]),y}(function(t){m(h,t);var n,i,u,c,s,l=(c=h,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=x(c);if(s){var n=x(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return w(this,t)});function h(){return r(this,h),l.apply(this,arguments)}return a(h,[{key:"firstOrCreate",value:(u=e(f().mark((function t(e){var n,r;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.tableNames(this.connector.migrationSchema.tables).concat(this.table.name),this.createTransaction(n,o.Write).mode===o.Write){t.next=4;break}throw new W("Transaction not in write mode");case 4:return t.next=6,this.first();case 6:if(r=t.sent){t.next=9;break}return t.abrupt("return",this.create(e));case 9:return t.abrupt("return",r);case 10:case"end":return t.stop()}}),t,this)}))),function(t){return u.apply(this,arguments)})},{key:"findOrCreate",value:(i=e(f().mark((function t(e,n){var r,i,a;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.tableNames(this.connector.migrationSchema.tables).concat(this.table.name),(i=this.createTransaction(r,o.Write)).mode===o.Write){t.next=4;break}throw new W("Transaction not in write mode");case 4:return this.setTransaction(i),t.next=7,this.find(e);case 7:if(a=t.sent){t.next=10;break}return t.abrupt("return",this.create(n));case 10:return t.abrupt("return",a);case 11:case"end":return t.stop()}}),t,this)}))),function(t,e){return i.apply(this,arguments)})},{key:"findIndexOrCreate",value:(n=e(f().mark((function t(e,n,r){var i,a;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=this.tableNames(this.connector.migrationSchema.tables).concat(this.table.name),this.createTransaction(i,o.Write).mode===o.Write){t.next=4;break}throw new W("Transaction not in write mode");case 4:return t.next=6,this.findIndex(e,n);case 6:if(a=t.sent){t.next=9;break}return t.abrupt("return",this.create(r));case 9:return t.abrupt("return",a);case 10:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return n.apply(this,arguments)})}]),h}(function(t){m(d,t);var n,i,u,c,s,l,h=(s=d,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=x(s);if(l){var n=x(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return w(this,t)});function d(){return r(this,d),h.apply(this,arguments)}return a(d,[{key:"create",value:function(t){var e=this,n=this.tableNames(this.connector.migrationSchema.tables).concat(this.table.name),r=this.getTransaction(n,o.Write).objectStore(this.table.name).add(t);return new Promise((function(n,i){r.addEventListener("success",(function(r){t[e.primaryId]=r.target.result,n(t)})),r.addEventListener("error",(function(t){return i(t)}))}))}},{key:"createMultiple",value:function(t){var e,n=this,r=this.tableNames(this.connector.migrationSchema.tables).concat(this.table.name),i=this.getTransaction(r,o.Write),a=i.objectStore(this.table.name),u=[],c=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return D(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){u=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}(t);try{var s=function(){var t=e.value,r=new Promise((function(e,r){var o=a.add(t);o.addEventListener("success",(function(r){t[n.primaryId]=r.target.result,e(t)})),o.addEventListener("error",(function(t){r(t),i.abort()}))}));u.push(r)};for(c.s();!(e=c.n()).done;)s()}catch(t){c.e(t)}finally{c.f()}return Promise.all(u)}},{key:"destroy",value:function(){var t,n=this,r=[this.table.name],i=this.getTransaction(r,o.Write).objectStore(this.table.name);if(0===this.builder.length&&null===this.indexBuilder)throw new Error("Deletion without builder is not allowed. Call truncate if you want to delete all records.");return t=0===this.builder.length&&null!==this.indexBuilder&&this.primaryId===this.indexBuilder.index?i.delete(this.keyRange(this.indexBuilder)):this.request(i),new Promise((function(r,i){var a=[];t.addEventListener("success",function(){var t=e(f().mark((function t(e){var i;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==n.builder.length||null===n.indexBuilder||n.primaryId!==n.indexBuilder.index){t.next=2;break}return t.abrupt("return",r(!0));case 2:if(!(i=e.target.result)){t.next=8;break}if(n.allowedToProcess(i.value)){t.next=6;break}return t.abrupt("return",i.continue());case 6:return a.push(n.delete(i.value[n.primaryId])),t.abrupt("return",i.continue());case 8:return t.next=10,Promise.all(a);case 10:r(!0);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.addEventListener("error",(function(t){return i(t)}))}))}},{key:"delete",value:(c=e(f().mark((function t(e){var n,r,i,a;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[this.table.name],r=this.getTransaction(n,o.Write),i=r.objectStore(this.table.name),a=i.delete(e),t.abrupt("return",new Promise((function(t,e){a.addEventListener("success",(function(){return t(!0)})),a.addEventListener("error",(function(t){return e(t)}))})));case 5:case"end":return t.stop()}}),t,this)}))),function(t){return c.apply(this,arguments)})},{key:"deleteIndex",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.resetBuilder(),n?this.whereIndex(t,e):this.whereMultiIndexIn(t,[e]),this.destroy()}},{key:"truncate",value:function(){var t=[this.table.name],e=this.getTransaction(t,o.Write).objectStore(this.table.name).clear();return new Promise((function(t,n){e.addEventListener("success",(function(){return t(!0)})),e.addEventListener("error",(function(t){return n(t)}))}))}},{key:"destroyId",value:function(t){return this.delete(t)}},{key:"update",value:function(t){var n=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=[this.table.name],a=this.getTransaction(i,o.Write),u=a.objectStore(this.table.name),c=this.request(u);return new Promise((function(i,a){var o=0,u=[];c.addEventListener("success",function(){var a=e(f().mark((function e(a){var c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(c=a.target.result)){e.next=7;break}if(n.allowedToProcess(c.value)){e.next=4;break}return e.abrupt("return",c.continue());case 4:u.push(n.save(c.value[n.primaryId],t,r)),o++,c.continue();case 7:return e.next=9,Promise.all(u);case 9:i(o);case 10:case"end":return e.stop()}}),e)})));return function(t){return a.apply(this,arguments)}}()),c.addEventListener("error",(function(t){return a(t)}))}))}},{key:"save",value:(u=e(f().mark((function t(e,n){var r,i,a,u,c,s,l,h=arguments;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=!(h.length>2&&void 0!==h[2])||h[2],i=[this.table.name],a=this.getTransaction(i,o.Write),t.next=5,this.findOrFail(e);case 5:if(u=t.sent,a.mode===o.Write){t.next=8;break}throw new W("Transaction not in write mode");case 8:return c=a.objectStore(this.table.name),(s=r?R(u,n):n)[this.primaryId]=e,l=c.put(s),t.abrupt("return",new Promise((function(t,e){l.addEventListener("success",(function(){t(!0)})),l.addEventListener("error",(function(t){return e(t)}))})));case 13:case"end":return t.stop()}}),t,this)}))),function(t,e){return u.apply(this,arguments)})},{key:"saveIndex",value:(i=e(f().mark((function t(e,n,r){var i,a,u,c,s=arguments;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=!(s.length>3&&void 0!==s[3])||s[3],a=[this.table.name],u=this.getTransaction(a,o.Write),t.next=5,this.findIndexOrFail(e,n);case 5:if(c=t.sent,u.mode===o.Write){t.next=8;break}throw new W("Transaction not in write mode");case 8:return t.abrupt("return",this.save(c[this.primaryId],r,i));case 9:case"end":return t.stop()}}),t,this)}))),function(t,e,n){return i.apply(this,arguments)})},{key:"saveAllIndex",value:(n=e(f().mark((function t(e,n,r){var i,a,u=arguments;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=!(u.length>3&&void 0!==u[3])||u[3],a=[this.table.name],this.getTransaction(a,o.Write).mode===o.Write){t.next=5;break}throw new W("Transaction not in write mode");case 5:return this.resetBuilder().whereIndex(e,n),t.next=8,this.update(r,i);case 8:return t.abrupt("return",Promise.resolve(!0));case 9:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return n.apply(this,arguments)})}]),d}(K)));function G(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return F(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?F(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){u=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}function F(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var U=function(){function t(e){r(this,t),this.migrationSchema=e,this.dbOpenConnection=null,this.migration=null,this.database=null}var n;return a(t,[{key:"connect",value:function(){var t=this;return this.dbOpenConnection=this.indexedDB().open(this.migrationSchema.name,this.migrationSchema.version),new Promise((function(n,r){if(null===t.dbOpenConnection)throw new Error("Database connection did not open");t.dbOpenConnection.addEventListener("success",(function(e){var r=t.completeHandler(e);n(r)})),t.dbOpenConnection.addEventListener("error",(function(t){r(t)})),t.dbOpenConnection.addEventListener("upgradeneeded",function(){var n=e(f().mark((function e(n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.migrateHandler(n);case 2:case"end":return e.stop()}}),e)})));return function(t){return n.apply(this,arguments)}}())}))}},{key:"destroy",value:function(t){var e=this.indexedDB().deleteDatabase(t);return new Promise((function(t,n){e.addEventListener("success",(function(){return t(!0)})),e.addEventListener("error",(function(t){return n(t)}))}))}},{key:"indexedDB",value:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(){var t=indexedDB||self.indexedDB||self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB;if(!t)throw new Error("IndexedDB constructor not found in environment");return t}))},{key:"migrateHandler",value:(n=e(f().mark((function t(e){var n;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new p(this.migrationSchema.tables,e.target.result,e.target.transaction),t.next=3,n.run();case 3:return this.migrationSchema.tables=t.sent,t.abrupt("return",!0);case 5:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"completeHandler",value:function(t){var e=this,n=this.migrationSchema.tables.map((function(t){return t.name})),r=t.target.transaction||t.target.result.transaction(n);this.database=t.target.result;var i=new p(this.migrationSchema.tables,t.target.result,r);this.migration=i;var a,o=i.listObjectStores(),u={},c=G(o);try{var s=function(){var n=a.value,r=e.migrationSchema.tables.find((function(t){return t.name===n.name}));Object.defineProperty(u,n.name,{get:function(){return r.ormClass?new r.ormClass(t.target.result,r,e):new H(t.target.result,r,e)}})};for(c.s();!(a=c.n()).done;)s()}catch(t){c.e(t)}finally{c.f()}return u}},{key:"getMigration",value:function(){return this.migration}},{key:"getDatabase",value:function(){return this.database}},{key:"openTransaction",value:function(t){var e=this;if(null===this.database)throw new Error("First initialize the connection using connect.");var n,r=this.database.transaction(this.migrationSchema.tables.map((function(t){return t.name}))),i={},a=G(this.migrationSchema.tables);try{var o=function(){var t=n.value;Object.defineProperty(i,t.name,{get:function(){var n=new H(e.database,t,e);return n.setTransaction(r),n}})};for(a.s();!(n=a.n()).done;)o()}catch(t){a.e(t)}finally{a.f()}return{models:i,transaction:r}}},{key:"close",value:function(){return this.database?(this.database.close(),Promise.resolve(!0)):Promise.reject("No Connection open")}}]),t}();!function(t){t.idb=function(t){return new U(t)},t.idbTypes={CursorTypes:{AscendingUnique:s.AscendingUnique,Ascending:s.Ascending,Descending:s.Descending,DescendingUnique:s.DescendingUnique},RelationTypes:{HasManyThroughMultiEntry:u.HasManyThroughMultiEntry,HasManyMultiEntry:u.HasManyMultiEntry,HasMany:u.HasMany,HasOne:u.HasOne},TransactionModes:{ReadOnly:o.ReadOnly,Write:o.Write,VersionChange:o.VersionChange}}}(self)})()})();
//# sourceMappingURL=idb.js.map